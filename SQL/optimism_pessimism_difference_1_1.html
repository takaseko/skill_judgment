<!-- ITを分かりやすく解説 -->

<!-- 1 悲観ロックと楽観ロックの違い
まず悲観ロックと楽観ロックは、どちらも排他制御の代表的の方式です。

1_1 排他制御って何？
排他制御とは、共有資源に対して同時にアクセスしても問題なく動作できる制御のこと
排他制御を行うことで共有資源のデータに不整合が起きることを防ぎます
（例）ショッピングサイト
ショッピングサイトの商品（共有資源）を同時に購入した時、排他制御が行われていない
① 共有資源の商品を同時に購入
共有資源の同じ商品をタイミング的に2人同時に購入する事は、そこまで発生する事ではない。
ただ人気のショッピングサイトであればあるほど、その可能性は高くなります。
② 在庫を確認する
購入した商品の在庫が残っているか確認します。今回の例では在庫は残り"10"とする
③ 在庫を減らす
次に在庫を減らします。在庫の残りは"10"なので、1つ減らして"9"にします。
（問題が発生）
ここで問題になるのは、排他制御をしていない為、同時に操作した両方が在庫を"10"から"1"減らした"9"で在庫数を更新してしまう。
そのため在庫数が本来とは違う、間違ったデータになってしまう。
（排他制御の目的）
上記のような問題を防ぐために排他制御があり、データの整合性を保つことが目的 -->

<!-- 2 悲観ロックって何？
・悲観ロックとは、排他制御の代表的な方式の一つで、同じデータを他者が頻繁に更新するという悲観的な考え方の排他制御
・具体的に言うと、更新対象データを取得時にロックして他者が操作できないようにする方式。

2_1 ① 共有資源の商品を同時に購入
（例）ショッピングサイトで「Aさん」と「Bさん」が同時に同じ商品（共有資源）を購入
在庫テーブル：10、商品ZをAさん：1購入、商品ZをBさん：1購入（同じタイミングで購入）

2_2 ② 共有資源に対してデータを読み取りロックする
・購入可能であるか確認するために「在庫テーブル」から対象商品の「在庫数」を取得。
・まずは「Aさん」がデータを取得。この時、対象商品のデータをロック。

2_3 ③ 共有資源はロックされているので、読み取りできない
・次に「Bさん」も「在庫テーブル」から対象の同じ商品の「在庫数」を取得しようとするが、対象商品のデータはロックされているので、読み取る事ができず、購入不可能
→そのため、ロックが解除されるまで待機する。

2_4 ④ 共有資源を更新し、ロックを解除する
・在庫を取得してきた10から1減らして「Aさん」の購入を確定
・「在庫テーブル」の「在庫数」は"9"です。更新が完了したらロックを解除します。（コミット または ロールバックのタイミングで解除）

2_5 ⑤ 再度、共有資源に対してデータを読み取りロックする
・対象商品のデータのロックが解除されたので、「Bさん」がデータを取得。この時、対象商品のデータをロックする。

2_6 ⑥ 共有資源を更新し、ロックを解除する
・在庫を取得してきた9から1減らして「Bさん」の購入を確定
・「在庫テーブル」の「在庫数」は"8"です。更新が完了したらロックを解除します。（コミット または ロールバックのタイミングで解除） -->



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
</head>
<body>
  
</body>
</html>